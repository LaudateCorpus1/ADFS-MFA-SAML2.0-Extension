Known issues in the Plugin and the Setup program and their solution

Plugin
======

Handling of SAML errors
-----------------------

The plugin does not handle SAML Errors generated by the SFO Server. Depending on the
SFO Gateway configuration this can lead to different Errors on the ADFS Server:
- A SAML Error response to /adfs/ls causes a generic "An error occurred. Contact your 
  administrator for more information" to be displayed on the ADFS Server. The "Activity ID" 
  displayed in the Error details does not match the Activity ID of the MFA Authentication 
  in the Plugin.
- A SAML Error response to /adfs/ causes a "HTTP Error 503. The service is unavailable."
  error to be displayed on the ADFS server.
  
The reason for these errors is that the SAML Error response from the SFO server does not 
contain the ADFS specific URL parameters and HTTP form parameters that are required for 
ADFS to recognise the response and forward it to the Plugin. We plan to address this in
a future update to the SFO Server (Stepup-Gateway) and the Plugin. In the mean time it
is useful to be aware of the scenarios that cause these errors to be displayed:
- The user cancels a MFA Authentication on the SFO Gateway
  Solution: Ask the user whether they cancelled the Authentication
- The user does not have an active token
  Solution: Ask the user to login to the self server portal and verify that she has an
  active token. Alternatively an RA can do this verification in the RA portal. If the
  user does not have an active token they must register and activate their token first.
- The user, identified by the Subject NameID, is not authorised to authenticate to the 
  SFO server
- The plugin uses a LoA identifier (AuthnConextClassRef) that is not recognised by the
  SFO server
The first two scenarios can affect individual users during normal use of the MFA extension
The last two scenarios are due to configuration issue in the plugin or SFO server and
would not occur once the plugin has been working.
  

Setup
=====

Incorrect RSA providerType error
--------------------------------

You get an "Incorrect RSA providerType: <nunmber>" error when importing a pfx in Setup.
Setup requires that the certificate is from the "Microsoft Enhanced RSA and AES 
Cryptographic Provider". You get this message when the .pfx you import references another 
Cryptographic service provider (CSP).
  
You can check the CSP specified in the .pfx using the  certutil.exe command:

  certutil.exe -dump the_certificsate.pfx
  
To use the certificate with Setup, you must create a .pfx file with the correct CSP.
You can either generate a new certificate using Setup, or convert the .pfx to include
the correct CSP. To convert the .pfx use the following procedure:

  1. Copy the old .pfx file to a Windows computer that does NOT have the certificate in
     its certificate store
  2. On this computer, use certutil to import the old .pfx file in the certificate store
     while overriding the CSP:
     certutil.exe -p password -csp "Microsoft Enhanced RSA and AES Cryptographic Provider" 
     -importPFX old_pfx_file.pfx
  3. Now export the certificate you just imported as a .pfx using the certificates snap-in. 
     Verify that the .pfx contains the correct CSP using: 
     certutil.exe -dump the_new_pfx_file.pfx
  4. Copy the new .pfx file to the ADFS server and run Setup again.

Not console input in Powershell ISE
-----------------------------------

Console input does not work when running "setup.exe" from "PowerShell ISE" making the 
application unusable. "setup.exe" is a console application that requires interactive input. 
This type of application is not supported by "PowerShell ISE". Run "setup.exe" from 
"powershell.exe" or "cmd.exe" instead.